!function(e,t){"use strict";function a(e){e.touches=[],e.touching=!1,this.on(X.dragStart,Y.killEvent),e.tap?(e.pan=!1,e.scale=!1,e.swipe=!1,this.on(X.touchStart,e,o).on(X.click,e,l),t.support.touch&&t.support.pointer&&this.on(X.pointerDown,e,o)):(e.pan||e.swipe||e.scale)&&(e.tap=!1,e.swipe&&(e.pan=!0),e.scale&&(e.axis=!1),e.axis?(e.axisX="x"===e.axis,e.axisY="y"===e.axis):d(this,"none"),this.on(X.touchStart,e,i).on(X.mouseDown,e,o),t.support.touch&&t.support.pointer&&this.on(X.pointerDown,e,i))}function n(){this.off(X.namespace),d(this,"")}function i(e){e.preventManipulation&&e.preventManipulation();var t=e.data,a=e.originalEvent;if(a.type.match(/(up|end|cancel)$/i))return void r(e);if(a.pointerId){var n=!1;for(var i in t.touches)t.touches[i].id===a.pointerId&&(n=!0,t.touches[i].pageX=a.clientX,t.touches[i].pageY=a.clientY);n||t.touches.push({id:a.pointerId,pageX:a.clientX,pageY:a.clientY})}else t.touches=a.touches;a.type.match(/(down|start)$/i)?o(e):a.type.match(/move$/i)&&s(e)}function o(t){var a=t.data,n="undefined"!==e.type(a.touches)?a.touches[0]:null;if(a.touching||(a.startE=t.originalEvent,a.startX=n?n.pageX:t.pageX,a.startY=n?n.pageY:t.pageY,a.startT=(new Date).getTime(),a.scaleD=1,a.passed=!1),a.tap)a.clicked=!1,a.$el.on([X.touchMove,X.pointerMove].join(" "),a,i).on([X.touchEnd,X.touchCancel,X.pointerUp,X.pointerCancel].join(" "),a,i);else if(a.pan||a.scale){a.$links&&a.$links.off(X.click);var o=u(a.scale?X.scaleStart:X.panStart,t,a.startX,a.startY,a.scaleD,0,0,"","");if(a.scale&&a.touches&&a.touches.length>=2){var p=a.touches;a.pinch={startX:h(p[0].pageX,p[1].pageX),startY:h(p[0].pageY,p[1].pageY),startD:g(p[1].pageX-p[0].pageX,p[1].pageY-p[0].pageY)},o.pageX=a.startX=a.pinch.startX,o.pageY=a.startY=a.pinch.startY}a.touching||(a.touching=!0,a.pan&&M.on(X.mouseMove,a,s).on(X.mouseUp,a,r),M.on([X.touchMove,X.touchEnd,X.touchCancel,X.pointerMove,X.pointerUp,X.pointerCancel].join(" "),a,i),a.$el.trigger(o))}}function s(t){var a=t.data,n="undefined"!==e.type(a.touches)?a.touches[0]:null,i=n?n.pageX:t.pageX,o=n?n.pageY:t.pageY,s=i-a.startX,p=o-a.startY,c=s>0?"right":"left",l=p>0?"down":"up",d=Math.abs(s)>E,f=Math.abs(p)>E;if(a.tap)(d||f)&&a.$el.off([X.touchMove,X.touchEnd,X.touchCancel,X.pointerMove,X.pointerUp,X.pointerCancel].join(" "));else if(a.pan||a.scale)if(!a.passed&&a.axis&&(a.axisX&&f||a.axisY&&d))r(t);else{!a.passed&&(!a.axis||a.axis&&a.axisX&&d||a.axisY&&f)&&(a.passed=!0),a.passed&&(Y.killEvent(t),Y.killEvent(a.startE));var v=!0,M=u(a.scale?X.scale:X.pan,t,i,o,a.scaleD,s,p,c,l);if(a.scale)if(a.touches&&a.touches.length>=2){var w=a.touches;a.pinch.endX=h(w[0].pageX,w[1].pageX),a.pinch.endY=h(w[0].pageY,w[1].pageY),a.pinch.endD=g(w[1].pageX-w[0].pageX,w[1].pageY-w[0].pageY),a.scaleD=a.pinch.endD/a.pinch.startD,M.pageX=a.pinch.endX,M.pageY=a.pinch.endY,M.scale=a.scaleD,M.deltaX=a.pinch.endX-a.pinch.startX,M.deltaY=a.pinch.endY-a.pinch.startY}else a.pan||(v=!1);v&&a.$el.trigger(M)}}function p(t,a){t.on(X.click,a,c);var n=e._data(t[0],"events").click;n.unshift(n.pop())}function c(e){Y.killEvent(e,!0),e.data.$links.off(X.click)}function r(t){var a=t.data;if(a.tap)a.$el.off([X.touchMove,X.touchEnd,X.touchCancel,X.pointerMove,X.pointerUp,X.pointerCancel,X.mouseMove,X.mouseUp].join(" ")),a.startE.preventDefault(),l(t);else if(a.pan||a.scale){var n="undefined"!==e.type(a.touches)?a.touches[0]:null,i=n?n.pageX:t.pageX,o=n?n.pageY:t.pageY,s=i-a.startX,c=o-a.startY,r=(new Date).getTime(),h=a.scale?X.scaleEnd:X.panEnd,g=s>0?"right":"left",d=c>0?"down":"up",f=Math.abs(s)>1,v=Math.abs(c)>1;if(a.swipe&&Math.abs(s)>E&&r-a.startT<w&&(h=X.swipe),a.axis&&(a.axisX&&v||a.axisY&&f)||f||v){a.$links=a.$el.find("a");for(var Y=0,k=a.$links.length;k>Y;Y++)p(a.$links.eq(Y),a)}var m=u(h,t,i,o,a.scaleD,s,c,g,d);M.off([X.touchMove,X.touchEnd,X.touchCancel,X.mouseMove,X.mouseUp,X.pointerMove,X.pointerUp,X.pointerCancel].join(" ")),a.$el.trigger(m),a.touches=[],a.scale}a.touching=!1}function l(e){Y.killEvent(e);var t=e.data,a=e.type;if("click"===a||!t.clicked){"click"!==a&&(t.clicked=!0);var n=t.startE?t.startX:e.pageX,i=t.startE?t.startY:e.pageY,o=u(X.tap,e.originalEvent,n,i,1,0,0);t.$el.trigger(o)}}function u(t,a,n,i,o,s,p,c,r){return e.Event(t,{originalEvent:a,bubbles:!0,pageX:n,pageY:i,scale:o,deltaX:s,deltaY:p,directionX:c,directionY:r})}function h(e,t){return(e+t)/2}function g(e,t){return Math.sqrt(e*e+t*t)}function d(e,t){e.css({"-ms-touch-action":t,"touch-action":t})}var f=!t.window.PointerEvent,v=t.Plugin("touch",{widget:!0,defaults:{axis:!1,pan:!1,scale:!1,swipe:!1,tap:!1},methods:{_construct:a,_destruct:n},events:{pointerDown:f?"MSPointerDown":"pointerdown",pointerUp:f?"MSPointerUp":"pointerup",pointerMove:f?"MSPointerMove":"pointermove",pointerCancel:f?"MSPointerCancel":"pointercancel"}}),X=v.events,Y=v.functions,M=t.$window,E=10,w=50;X.tap="tap",X.pan="pan",X.panStart="panstart",X.panEnd="panend",X.scale="scale",X.scaleStart="scalestart",X.scaleEnd="scaleend",X.swipe="swipe"}(jQuery,Formstone);